require 'dotenv'

default_platform(:android)

platform :android do
  desc "build apk/aab"
  lane :dev do
    Dotenv.load('../../.env')
    Dir.chdir("../..") do
        sh('flutter', 'build', 'apk', '--flavor', ENV['FLAVOR'], '--target', ENV['TARGET'], '--no-shrink')
    end
    firebase_app_distribution(
        app: ENV['FIREBASE_ANDROID_APP_ID'],
        firebase_cli_token: ENV['PRIVATE_FIREBASE_CLI_TOKEN'],
        android_artifact_type: "APK",
        android_artifact_path: ENV['ANDROID_ARTIFACT_PATH'],
        testers_file: ENV['TESTERS_FILE'],
        groups_file: ENV['GROUPS_FILE'],
        release_notes_file: ENV['RELEASE_NOTES_FILE']
    )
  end

  lane :prod do
    Dir.chdir("../..") do
        sh('flutter', 'build', 'appbundle', '--flavor', ENV['FLAVOR'], '--no-shrink')
    end
  end
end