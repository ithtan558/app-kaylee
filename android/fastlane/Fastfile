require 'dotenv'

default_platform(:android)

platform :android do
  desc "build apk/aab"
  before_all do
    Dir.chdir('../..') do
        Dotenv.load('.env')
    end
  end
  lane :dev do
    Dir.chdir('../..') do
        Dotenv.load('.env.dev')
    end
    flutter_build(
        build: 'apk',
        build_args: ['--flavor', ENV['FLAVOR'], '--target',ENV['TARGET'], '--no-shrink']
    )
    firebase_app_distribution(
        app: ENV['FIREBASE_ANDROID_APP_ID'],
        firebase_cli_token: ENV['PRIVATE_FIREBASE_CLI_TOKEN'],
        android_artifact_type: "APK",
        android_artifact_path: ENV['ANDROID_ARTIFACT_PATH'],
        testers_file: ENV['TESTERS_FILE'],
        groups_file: ENV['GROUPS_FILE'],
        release_notes_file: ENV['RELEASE_NOTES_FILE']
    )
  end

  lane :prod do
    Dir.chdir('../..') do
        Dotenv.load('.env.prod')
    end
    flutter_build(
        build: 'appbundle',
        build_args: ['--flavor', ENV['FLAVOR'], '--target', ENV['TARGET'], '--no-shrink']
    )
  end
end